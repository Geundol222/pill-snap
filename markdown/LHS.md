# 🧪 실험 및 공부 내용

## ⚙️ 실험 환경
- **Baseline 모델**: YOLOv12s (Ultralytics)
- **데이터셋**: 알약 이미지 데이터 (pseudo-labeling + 보정 적용)
- **평가지표**: Validation mAP@[0.75:0.95]
- **하드웨어**: RTX 3060 Ti (8GB VRAM)
- **프레임워크**: Ultralytics YOLO (v12), Python 3.12.10, CUDA 12.8

## 🔍 EDA 실험

### 📌 가정
- 일부 데이터는 **라벨(Annotation) 자체가 없음** → pseudo-labeling 필요  
- pseudo-labeling으로 채운 bbox는 여전히 오차 존재 → **IoU 대신 CIoU 지표**로 비교 및 보정  
- 보정된 bbox를 이용하면 모델 성능 상승 가능  

### 📊 결과
**Pseudo-labeling**
- 이미지가 약 **3가지 각도(70°, 75°, 90°)** 로 촬영된 것으로 추정  
- 해당 이미지의 annotation이 누락된 경우, 가장 유사한 각도의 json 복사로 대체  
- Baseline YOLOv12 모델을 활용해 bbox 예측 후 IoU로 비교·보정  
- **점수: 0.965 → 0.976 (+0.011)**

**CIoU 적용**
- 대부분의 bbox가 알약을 정확히 감싸는 형태로 보정됨  
- CIoU: 겹치는 영역뿐 아니라 **중심점 거리 + 너비·높이 비율**까지 고려  
- **점수: 0.976 → 0.983 (+0.007)**

---

## ⚙️ 모델 실험

### 📌 가정
- **Epoch 수 증가** → 성능 상승 여부 확인  
- 알약의 회전/기울임이 심하므로 **RandomAffine 강하게 적용**  
- 흐릿한 글자를 살리기 위해 **HSV 조절(h, s, v)**  
- **Mixup**은 글자 디테일 손상 우려 → 0.0 ~ 0.2로 제한  
- bbox 누락 문제 → **CutMix, CutOut, 혹은 EDA 방식**과 비교 고민  
- 작은 글씨 디테일 보존을 위해 **imgsz 확대** 실험  
- **랜덤 서치 적용 중**

### 📊 결과

#### Epoch
- **5 epochs** (no EDA/전처리): mAP@[0.75:0.95] = **0.80**  
- **30 epochs** (no EDA/전처리): mAP@[0.75:0.95] = **0.87**

#### RandomAffine
| Params | Epochs | mAP@[0.75:0.95] |
|--------|--------|-----------------|
| degrees=120, translate=0.8, scale=0.8, shear=15 | 30 | 0.73 |
| degrees=120, shear=15 | 30 | 0.80 |
| degrees=60, shear=15 | 30 | 0.81 |
| degrees=45, shear=15 | 30 | 0.83 |
| degrees=30, shear=15 | 30 | 0.79 |

➡️ YOLO 기본 설정보다 성능 저하 → **각도 변경은 보류**

#### Mixup
| mixup | Epochs | mAP@[0.75:0.95] |
|-------|--------|-----------------|
| 0.0   | 30     | 0.86 |
| 0.1   | 30     | 0.87 |
| 0.2   | 30     | 0.86 |

➡️ YOLO 기본 설정과 큰 차이 없음

#### HSV
- hsv_h=0.015, hsv_s=0.5, hsv_v=0.4 → mAP@[0.75:0.95] = **0.87**

#### Image Size
| imgsz | batch | nbs | HSV 옵션 | Epochs | mAP@[0.75:0.95] |
|-------|-------|-----|----------|--------|-----------------|
| 960   | 4     | 16  | -        | 30     | 0.86 |
| 960   | 4     | 16  | h=0.1, s=0.5, v=0.3 | 30 | 0.86 |

---

## 📝 결론

